# æ‰‹ç»­è´¹åŠŸèƒ½å®ç°æŠ¥å‘Š

## ğŸ” é—®é¢˜åˆ†æ

### å‘ç°çš„é—®é¢˜
åœ¨ç§¯åˆ†å…‘æ¢æ¶ˆè´¹åˆ¸é¡µé¢ï¼Œæ‰‹ç»­è´¹ç‡è¢«ç¡¬ç¼–ç ä¸º `0.0`ï¼Œå¯¼è‡´ï¼š
- âœ… æ‰‹ç»­è´¹æ˜¾ç¤ºä¸º 0%
- âœ… æŸè€—æ•°é‡å§‹ç»ˆä¸º 0
- âœ… å®é™…åˆ°è´¦æ•°é‡ç­‰äºè¾“å…¥æ•°é‡

### uni-app ç‰ˆæœ¬çš„å®ç°
åœ¨ `shsdapp/pages/users/jifendswp/jifendswp.vue` ä¸­ï¼š
```javascript
// æ‰‹ç»­è´¹ç‡ä»ç”¨æˆ·ä¿¡æ¯ä¸­è·å–
{{userInfo.xfq_sxf}}%

// è®¡ç®—æŸè€—æ•°é‡
this.xfqsxfnum = (newV * this.userInfo.xfq_sxf / 100).toFixed(2)

// è®¡ç®—å®é™…åˆ°è´¦
this.dznum = (newV - this.xfqsxfnum).toFixed(2)
```

## âœ… å®ç°æ–¹æ¡ˆ

### 1. æ·»åŠ æ‰‹ç»­è´¹å­—æ®µåˆ° UserModel

**æ–‡ä»¶**: `lib/app/data/models/user_model.dart`

```dart
@JsonKey(fromJson: stringToDouble)
final double xfqSxf; // æ¶ˆè´¹åˆ¸æ‰‹ç»­è´¹ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
```

**å­—æ®µè¯´æ˜**:
- å­—æ®µå: `xfqSxf` (å¯¹åº”åç«¯çš„ `xfq_sxf`)
- ç±»å‹: `double`
- å•ä½: ç™¾åˆ†æ¯”ï¼ˆä¾‹å¦‚ï¼š50 è¡¨ç¤º 50%ï¼‰
- é»˜è®¤å€¼: 0

### 2. æ›´æ–°å…‘æ¢é¡µé¢é€»è¾‘

**æ–‡ä»¶**: `lib/pages/task/pages/jifen_exchange_page.dart`

#### 2.1 è®¡ç®—æ‰‹ç»­è´¹
```dart
void _onInputChanged() {
  final text = _controller.text;
  if (text.isEmpty) {
    setState(() {
      _jfnum = 0;
      _xfqsxfnum = 0;
      _dznum = 0;
    });
    return;
  }

  final value = double.tryParse(text) ?? 0;
  // ä»ç”¨æˆ·ä¿¡æ¯ä¸­è·å–æ‰‹ç»­è´¹ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
  final sxfRate = (_userInfo?.xfqSxf ?? 0) / 100;

  setState(() {
    _jfnum = value;
    _xfqsxfnum = double.parse((value * sxfRate).toStringAsFixed(2));
    _dznum = double.parse((value - _xfqsxfnum).toStringAsFixed(2));
  });
}
```

#### 2.2 æ˜¾ç¤ºæ‰‹ç»­è´¹ç‡
```dart
Text(
  '${_userInfo?.xfqSxf ?? 0}%',
  style: const TextStyle(
    fontSize: 12,
    color: Color(0xFFFF5A5A),
  ),
),
```

### 3. é‡æ–°ç”Ÿæˆä»£ç 

è¿è¡Œå‘½ä»¤ç”Ÿæˆ `user_model.g.dart`:
```bash
dart run build_runner build --delete-conflicting-outputs
```

## ğŸ“Š è®¡ç®—é€»è¾‘

### å…¬å¼

1. **æ‰‹ç»­è´¹ç‡**: ä»åç«¯è·å–ï¼ˆç™¾åˆ†æ¯”ï¼‰
   ```
   sxfRate = userInfo.xfqSxf / 100
   ```

2. **æŸè€—æ•°é‡**: 
   ```
   xfqsxfnum = jfnum Ã— sxfRate
   ```

3. **å®é™…åˆ°è´¦æ•°é‡**:
   ```
   dznum = jfnum - xfqsxfnum
   ```

### ç¤ºä¾‹

å‡è®¾ç”¨æˆ·è¾“å…¥ 1000 ç§¯åˆ†ï¼Œæ‰‹ç»­è´¹ç‡ä¸º 50%ï¼š

```
è¾“å…¥æ•°é‡: 1000
æ‰‹ç»­è´¹ç‡: 50% (0.5)
æŸè€—æ•°é‡: 1000 Ã— 0.5 = 500
å®é™…åˆ°è´¦: 1000 - 500 = 500
```

## ğŸ¯ æ•°æ®æµ

```
åç«¯ API
  â†“
è¿”å›ç”¨æˆ·ä¿¡æ¯ (åŒ…å« xfq_sxf: 50)
  â†“
UserModel.xfqSxf = 50
  â†“
ç”¨æˆ·è¾“å…¥å…‘æ¢æ•°é‡
  â†“
_onInputChanged() è®¡ç®—
  â†“
æ˜¾ç¤º: æ‰‹ç»­è´¹ 50%, æŸè€— 500, åˆ°è´¦ 500
```

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | è¯´æ˜ |
|------|---------|------|
| `lib/app/data/models/user_model.dart` | æ·»åŠ  `xfqSxf` å­—æ®µ | å­˜å‚¨æ‰‹ç»­è´¹ç‡ |
| `lib/pages/task/pages/jifen_exchange_page.dart` | æ›´æ–°è®¡ç®—é€»è¾‘ | ä»ç”¨æˆ·ä¿¡æ¯è·å–è´¹ç‡ |
| `lib/pages/task/pages/jifen_exchange_page.dart` | æ›´æ–°æ˜¾ç¤ºé€»è¾‘ | æ˜¾ç¤ºå®é™…è´¹ç‡ |
| `lib/app/data/models/user_model.g.dart` | è‡ªåŠ¨ç”Ÿæˆ | JSON åºåˆ—åŒ–ä»£ç  |

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

1. **åŠ¨æ€è·å–**: æ‰‹ç»­è´¹ç‡ä»åç«¯åŠ¨æ€è·å–ï¼Œå¯éšæ—¶è°ƒæ•´
2. **å®æ—¶è®¡ç®—**: ç”¨æˆ·è¾“å…¥æ—¶å®æ—¶è®¡ç®—æŸè€—å’Œåˆ°è´¦æ•°é‡
3. **ç²¾ç¡®æ˜¾ç¤º**: ä¿ç•™ä¸¤ä½å°æ•°ï¼Œç¡®ä¿è®¡ç®—ç²¾åº¦
4. **ç”¨æˆ·å‹å¥½**: æ¸…æ™°æ˜¾ç¤ºæ‰‹ç»­è´¹ç‡ã€æŸè€—æ•°é‡å’Œå®é™…åˆ°è´¦

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1: æ‰‹ç»­è´¹ç‡ä¸º 0%
```
è¾“å…¥: 1000
æ‰‹ç»­è´¹: 0%
æŸè€—: 0
åˆ°è´¦: 1000
```

### åœºæ™¯ 2: æ‰‹ç»­è´¹ç‡ä¸º 50%
```
è¾“å…¥: 1000
æ‰‹ç»­è´¹: 50%
æŸè€—: 500
åˆ°è´¦: 500
```

### åœºæ™¯ 3: æ‰‹ç»­è´¹ç‡ä¸º 10%
```
è¾“å…¥: 1000
æ‰‹ç»­è´¹: 10%
æŸè€—: 100
åˆ°è´¦: 900
```

### åœºæ™¯ 4: å°æ•°è®¡ç®—
```
è¾“å…¥: 123
æ‰‹ç»­è´¹: 50%
æŸè€—: 61.50
åˆ°è´¦: 61.50
```

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. åç«¯å­—æ®µå
ç¡®ä¿åç«¯è¿”å›çš„å­—æ®µåä¸º `xfq_sxf`ï¼ŒFlutter ä¼šè‡ªåŠ¨è½¬æ¢ä¸º `xfqSxf`ã€‚

### 2. æ•°æ®ç±»å‹
æ‰‹ç»­è´¹ç‡å­˜å‚¨ä¸º `double` ç±»å‹ï¼Œå•ä½æ˜¯ç™¾åˆ†æ¯”ï¼ˆä¸æ˜¯å°æ•°ï¼‰ã€‚

### 3. é»˜è®¤å€¼
å¦‚æœåç«¯æœªè¿”å›æ‰‹ç»­è´¹ç‡ï¼Œé»˜è®¤ä¸º 0ï¼Œä¸å½±å“å…‘æ¢åŠŸèƒ½ã€‚

### 4. ç²¾åº¦å¤„ç†
æ‰€æœ‰é‡‘é¢è®¡ç®—éƒ½ä¿ç•™ä¸¤ä½å°æ•°ï¼Œä½¿ç”¨ `toStringAsFixed(2)` ç¡®ä¿ç²¾åº¦ã€‚

## ğŸ‰ å®ŒæˆçŠ¶æ€

- âœ… UserModel æ·»åŠ æ‰‹ç»­è´¹å­—æ®µ
- âœ… è®¡ç®—é€»è¾‘æ›´æ–°
- âœ… æ˜¾ç¤ºé€»è¾‘æ›´æ–°
- âœ… ä»£ç ç”Ÿæˆå®Œæˆ
- âœ… ä¸ uni-app ç‰ˆæœ¬é€»è¾‘ä¸€è‡´

## ğŸ”„ ä¸ uni-app å¯¹æ¯”

| åŠŸèƒ½ | uni-app | Flutter | çŠ¶æ€ |
|------|---------|---------|------|
| è·å–æ‰‹ç»­è´¹ç‡ | `userInfo.xfq_sxf` | `_userInfo?.xfqSxf` | âœ… ä¸€è‡´ |
| è®¡ç®—æŸè€— | `newV * xfq_sxf / 100` | `value * sxfRate` | âœ… ä¸€è‡´ |
| è®¡ç®—åˆ°è´¦ | `newV - xfqsxfnum` | `value - _xfqsxfnum` | âœ… ä¸€è‡´ |
| æ˜¾ç¤ºè´¹ç‡ | `{{userInfo.xfq_sxf}}%` | `${_userInfo?.xfqSxf}%` | âœ… ä¸€è‡´ |

**Flutter ç‰ˆæœ¬å·²å®Œå…¨å®ç° uni-app çš„æ‰‹ç»­è´¹é€»è¾‘ï¼** ğŸŠ
