# 启动页5秒停留优化

## 需求

- 启动页至少停留5秒
- 5秒后才显示开屏广告
- 不显示倒计时或任何提示文字
- 简洁的启动页面

## 实现方案

### 1. 时间控制

**最小显示时间：5秒**
```dart
// 设置最小显示时间（5秒）
Future.delayed(const Duration(seconds: 5), () {
  debugPrint('⏰ 启动页最小显示时间（5秒）已到');
  if (mounted) {
    setState(() {
      _minTimeReached = true;
    });
  }
});
```

**最大等待时间：8秒**
```dart
// 设置最大等待时间（8秒）- 5秒启动页 + 3秒等待广告
Future.delayed(const Duration(seconds: 8), () {
  if (!_hasNavigated && mounted) {
    debugPrint('⏰ 总超时（8秒），跳转主页');
    _navigateToMain();
  }
});
```

### 2. 广告显示逻辑

只有在最小时间（5秒）已到时，才隐藏启动页显示广告：

```dart
if (ret.action == ZJEventAction.onAdShow) {
  debugPrint('✅ 开屏广告展示中');
  if (mounted) {
    setState(() {
      _adLoaded = true;
      // 只有在最小时间已到时才隐藏启动页
      if (_minTimeReached) {
        _showSplashContent = false;
      }
    });
  }
}
```

### 3. 简洁的启动页

移除了所有提示文字和调试信息：

```dart
// ✅ 简洁版本
Column(
  children: [
    Logo,
    '数航商道',
    '优质商品，品质生活',
    CircularProgressIndicator(), // 只显示加载动画
  ],
)

// ❌ 之前的版本（有提示文字）
Column(
  children: [
    Logo,
    '数航商道',
    '优质商品，品质生活',
    CircularProgressIndicator(),
    '广告加载中...', // 移除
    '最小时间: 已到/未到', // 移除
    '广告状态: 已加载/加载中', // 移除
  ],
)
```

## 时间线

### 场景1：广告加载成功（3秒内）

```
0秒 ─────────────────────────────────────────────────────────────────
     │ 应用启动
     │ 显示启动页（Logo + 加载动画）
     │
1秒  │ 广告开始加载
     │
3秒  │ 广告加载完成（onAdShow）
     │ 但启动页继续显示（未到5秒）
     │
5秒 ─┤ 最小时间已到
     │ 隐藏启动页，显示广告
     │
     │ 用户观看广告...
     │
     │ 用户关闭广告或广告播放完成
     │
     └─> 跳转主页
```

### 场景2：广告加载较慢（5-8秒）

```
0秒 ─────────────────────────────────────────────────────────────────
     │ 应用启动
     │ 显示启动页（Logo + 加载动画）
     │
1秒  │ 广告开始加载
     │
5秒 ─┤ 最小时间已到
     │ 但广告还未加载完成
     │ 继续显示启动页
     │
6秒  │ 广告加载完成（onAdShow）
     │ 立即隐藏启动页，显示广告
     │
     │ 用户观看广告...
     │
     │ 用户关闭广告或广告播放完成
     │
     └─> 跳转主页
```

### 场景3：广告加载失败

```
0秒 ─────────────────────────────────────────────────────────────────
     │ 应用启动
     │ 显示启动页（Logo + 加载动画）
     │
1秒  │ 广告开始加载
     │
2秒  │ 广告加载失败（onAdError）
     │ 但启动页继续显示（未到5秒）
     │
5秒 ─┤ 最小时间已到
     │ 跳转主页
```

### 场景4：广告超时

```
0秒 ─────────────────────────────────────────────────────────────────
     │ 应用启动
     │ 显示启动页（Logo + 加载动画）
     │
1秒  │ 广告开始加载
     │
5秒 ─┤ 最小时间已到
     │ 但广告还未加载完成
     │ 继续显示启动页
     │
8秒 ─┤ 总超时
     │ 跳转主页
```

## 用户体验

### 优点

1. **统一的体验**：所有用户都至少看到5秒启动页
2. **不会一闪而过**：避免启动页快速消失的不良体验
3. **简洁美观**：没有倒计时或提示文字，更专业
4. **平滑过渡**：启动页 → 广告 → 主页，过渡自然

### 时间分配

| 阶段 | 时间 | 说明 |
|------|------|------|
| 启动页 | 5秒 | 固定显示时间 |
| 广告 | 3-5秒 | 取决于广告内容 |
| 总计 | 8-10秒 | 从启动到进入主页 |

## 对比uni-app

### uni-app
```vue
<!-- uni-app使用DCloud广告，自动处理时间 -->
<ad-splash adpid="xxx"></ad-splash>
```

### Flutter（我们的实现）
```dart
// 手动控制时间
// 1. 启动页显示5秒
// 2. 5秒后显示广告
// 3. 广告关闭后跳转主页
```

## 日志输出

### 正常流程
```
🚀 开屏页面：开始加载开屏广告
📱 广告位ID: J8120762208
📱 应用ID: Z0062563231
📱 开始加载开屏广告
📢 开屏广告事件: action=onAdShow, msg=null
✅ 开屏广告展示中
⏰ 启动页最小显示时间（5秒）已到
(隐藏启动页，显示广告)
📢 开屏广告事件: action=onAdClose, msg=null
❌ 开屏广告关闭
🏠 跳转到主页
```

### 广告失败流程
```
🚀 开屏页面：开始加载开屏广告
📱 广告位ID: J8120762208
📱 应用ID: Z0062563231
📱 开始加载开屏广告
📢 开屏广告事件: action=onAdError, msg=xxx
⚠️ 开屏广告错误: xxx
⏰ 等待最小显示时间，剩余 3000ms
⏰ 启动页最小显示时间（5秒）已到
🏠 跳转到主页
```

## 注意事项

### 1. 不要设置太长的时间

5秒是一个平衡点：
- 太短（1-2秒）：用户感觉太快，体验不好
- 太长（10秒+）：用户等待时间过长，可能流失

### 2. 广告加载时间

如果广告经常加载超过3秒，考虑：
- 检查网络连接
- 优化广告SDK配置
- 预加载广告

### 3. 用户反馈

如果用户反馈等待时间太长，可以：
- 缩短启动页时间（3-4秒）
- 添加跳过按钮（仅生产环境）
- 优化广告加载速度

## 总结

优化后的启动流程：

1. ✅ **启动页固定显示5秒** - 不会一闪而过
2. ✅ **5秒后显示广告** - 平滑过渡
3. ✅ **简洁的界面** - 没有倒计时或提示文字
4. ✅ **容错机制** - 广告失败或超时自动跳转

用户体验更加统一和专业！
